<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Server-side state · Matte.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="Matte.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Matte.jl</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Matte</a></li><li><a class="tocitem" href="g01-getting-started.html">Getting started</a></li><li><span class="tocitem">Guides</span><ul><li><a class="tocitem" href="g02-intro.html">Introduction to Matte</a></li><li><a class="tocitem" href="g03-ui.html">Building UIs</a></li><li><a class="tocitem" href="g04-server.html">Server logic</a></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Displaying data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="g05a-dataframes.html">DataFrames</a></li><li><a class="tocitem" href="g05b-plots.html">Plots</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox" checked/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">State and side-effects</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href="g06a-server-side-state.html">Server-side state</a><ul class="internal"><li><a class="tocitem" href="#A-quick-example-1"><span>A quick example</span></a></li><li><a class="tocitem" href="#Step-1:-Registering-session-variables-1"><span>Step 1: Registering session variables</span></a></li><li><a class="tocitem" href="#Step-2:-Accessing-and-mutating-session-variables-1"><span>Step 2: Accessing and mutating session variables</span></a></li></ul></li><li><a class="tocitem" href="g06b-side-effects.html">Side effects and manually updating the UI</a></li></ul></li><li><a class="tocitem" href="g07-long-running-computations.html">Dealing with long-running computations</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="r01-layouts.html">UI Layouts</a></li><li><a class="tocitem" href="r02-input-elements.html">Input elements</a></li><li><a class="tocitem" href="r03-output-elements.html">Output elements</a></li><li><a class="tocitem" href="r04-ui-style.html">Controlling style</a></li><li><a class="tocitem" href="r05-running-creating.html">Running and creating Matte apps</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Guides</a></li><li><a class="is-disabled">State and side-effects</a></li><li class="is-active"><a href="g06a-server-side-state.html">Server-side state</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="g06a-server-side-state.html">Server-side state</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/angusmoore/Matte.jl/blob/master/docs/src/g06a-server-side-state.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="g06a-server-side-state-1"><a class="docs-heading-anchor" href="#g06a-server-side-state-1">Server-side state</a><a class="docs-heading-anchor-permalink" href="#g06a-server-side-state-1" title="Permalink"></a></h1><p>So far, all our apps have had not concept of &#39;state&#39;. Our server-side functions take the current value of the inputs in the UI, and return some output. Our app has no memory, no way of knowing what has happened in the past.</p><p>But what if we want to know what happened in the past?</p><p>Consider a simple problem. Suppose we want to create an app that just tracks how many times the user has clicked a button, and then displays that result. With everything we&#39;ve learned so far, we can&#39;t. A <code>button</code> input just tells the server whether it has been clicked or not: it returns only <code>true</code> or <code>false</code>.</p><p>Enter <code>session</code>. <code>session</code> is a way for you to be able to create variables that have a value that is <em>persistent</em>.</p><h2 id="A-quick-example-1"><a class="docs-heading-anchor" href="#A-quick-example-1">A quick example</a><a class="docs-heading-anchor-permalink" href="#A-quick-example-1" title="Permalink"></a></h2><p>To see this in action, let&#39;s create a copy of the <code>server_state</code> example app, which implements exactly the problem we outlined above – track how many times a button is pushed.</p><pre><code class="language-none">matte_example(&quot;server_state&quot;, &quot;server_state&quot;)
includet(&quot;app.jl&quot;)
run_app(ServerStateExample)</code></pre><p>You&#39;ll see an app that looks something like this, and the counter on the right will increment by 1 every time your push the button. If you refresh the page (starting a new session), the counter returns to zero.</p><p><img src="assets/g06a-server-state.png" alt/></p><h2 id="Step-1:-Registering-session-variables-1"><a class="docs-heading-anchor" href="#Step-1:-Registering-session-variables-1">Step 1: Registering session variables</a><a class="docs-heading-anchor-permalink" href="#Step-1:-Registering-session-variables-1" title="Permalink"></a></h2><p>The first step in having persistent vars is <em>defining</em> or &#39;registering&#39; them. Matte needs to know, in advance, the names of the variables you want to be able use. And you need to tell Matte what initial value that variable should have when the session first starts. This is done using the function <code>register_session_vars</code>. This function should be declared inside your app module (at the top level, like the <code>ui</code> function). It takes no inputs, and should return a <code>Dict</code>. This <code>Dict</code> maps symbols to values – the symbols are the variables that you will have access to.</p><p>In our example app, we only want one variable to track – the number of times the user has pushed the button. Let&#39;s call it <code>count</code> and assign it a value of <code>0</code> to begin with:</p><pre><code class="language-none">function register_session_vars()
    Dict(
        :count =&gt; 0
    )
end</code></pre><h2 id="Step-2:-Accessing-and-mutating-session-variables-1"><a class="docs-heading-anchor" href="#Step-2:-Accessing-and-mutating-session-variables-1">Step 2: Accessing and mutating session variables</a><a class="docs-heading-anchor-permalink" href="#Step-2:-Accessing-and-mutating-session-variables-1" title="Permalink"></a></h2><p>These session variables are accessed slightly differently to regular inputs. Any server function that you want to have access to a persistent variable <em>must</em> take an argument named <code>session</code> as an input. You access the session variables you registered with <code>register_session_vars</code> using the <code>.</code> syntax to access the field of the <code>session</code> – i.e. <code>session.my_variable</code> etc. You can change the value of the variable simply by assigning to this field.</p><p>In our example, we need a function that displays the current count, and that increments the count whenever <code>my_button</code> is pushed:</p><pre><code class="language-none">function my_count(my_button, session)
    if my_button
        session.count += 1
    end
    session.count
end</code></pre><p>The first conditional increments the count if <code>my_button = true</code> (i.e. if the button has been pushed) by setting <code>session.count += 1</code>.</p><p>The final line simply returns the current value of the count, to be displayed in the app.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"></div></div><p>Be careful: <code>session</code> variables are <em>not</em> reactive. That means that changing the value   of a session variable in one function will not induce recomputation of any other outputs   that depend on that session variable.</p><p>In the <a href="g06b-side-effects.html#g06b-side-effects-1">next guide</a>, we&#39;ll look at an important complement to <code>session</code> variables: being able to change the value of <em>other</em> UI elements within a server-side function.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="g05b-plots.html">« Plots</a><a class="docs-footer-nextpage" href="g06b-side-effects.html">Side effects and manually updating the UI »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 18 February 2020 08:15">Tuesday 18 February 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
